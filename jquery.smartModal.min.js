/**
 * jQuery smartModal
 * 
 * Version: 1.1.1
 * Author: Ben Marshall
 * Author URL: http://www.benmarshall.me
 * Plugin URL: http://www.benmarshall.me/jquery-smartmodal/
 * GitHub: https://github.com/bmarshall511/jquery-smartModal
 * 
 * Licensed under the MIT license
 */

(function(i){var g={overlayDelay:300,hideDelay:300,cookieExpires:365,debug:false,shortkeys:true,clickClose:true,animationDuration:800,animationEasing:"linear"},b=false,d=false,c=0,a=[],j=[],m=[],h=i("<div />").addClass("smartmodal-overlay").attr("id","smartmodal-overlay").css("display","none"),f={init:function(){if(typeof(Storage)!=="undefined"){b=true}else{if(g.debug){console.log("smartModal Notice: Web storage is not supported. Using the jQuery.cookie plugin instead.")}}if(i.cookie){d=true}else{if(g.debug){console.log("smartModal Notice: The jQuery.cookie plugin could not be loaded. smartModal cookie functionality has been disabled.")}}l();e();k()},showModal:function(n){var v=i("#"+n),r=false,s=g.animationEasing,q=g.animationDuration,p,t,u=true,o=g.cookieExpires;if(!v.length){if(g.debug){console.log("smartModal Error: Modal (#"+n+") not found.")}return false}v.addClass("smartmodal-modal");f.positionModal(n);if(!i("#smartmodal-overlay").length){i("body").append(h)}if(v.data("animation")){if(v.data("animation").indexOf("|")>=0){t=v.data("animation").split("|");if(array[0]){p=array[0]}if(array[1]){s=array[1]}if(array[2]){q=parseInt(array[2])}}else{start=v.data("animation")}r=true;f.positionModal(n,p)}h.fadeIn(g.overlayDelay);if(r){v.show().animate({left:f.calculatePos(v,"left"),top:f.calculatePos(v,"top")},{duration:q,specialEasing:{top:s}})}else{v.fadeIn(g.overlayDelay)}if(v.data("time")){if(v.data("close")&&v.data("close")=="manual"){u=false;i(".close",v).hide()}if(u){a[n]=window.setTimeout(function(){var w=false;if(v.hasClass("sticky")){v.removeClass("sticky");w=true}f.closeModal(n);if(w){v.addClass("sticky")}},(v.data("time")*1000))}if(i(".sec",v).length){i(".sec",v).text(v.data("time"));j[n]=window.setInterval(function(){var w=parseInt(i(".sec",v).text())-1;if(w>=0){i(".sec",v).text(w)}else{if(!u&&i(".close",v).is(":hidden")){if(v.hasClass("sticky")&&v.data("time")){v.removeClass("sticky").addClass("wasSticky")}i(".close",v).show()}window.clearInterval(j[n])}},1000)}}if(v.hasClass("once")){if(b){localStorage["smartModal-"+n]="shown"}else{if(d){if(v.data("expires")){o=v.data("expires")}i.cookie("smartModal-"+n,"shown",{path:"/",expires:o})}}if(i("."+n).length){i("."+n).unbind("click")}}},closeModal:function(o){if(i("#"+o).length){var n=i("#"+o);if(!n.hasClass("sticky")){if(n.hasClass("wasSticky")){n.removeClass("wasSticky").addClass("sticky")}if(j[o]){window.clearInterval(j[o])}if(a[o]){window.clearTimeout(a[o])}n.fadeOut(g.hideDelay,function(){if(!i(".smartmodal-modal:visible").length){f.removeOverlay()}})}}},removeOverlay:function(){if(i("#smartmodal-overlay").length){i("#smartmodal-overlay").fadeOut(g.hideDelay,function(){i(this).remove()})}},positionModal:function(p,o){if(p){if(i("#"+p).length){var n=i("#"+p);if(o){switch(o){case"top":n.css({top:-(n.height()),left:f.calculatePos(n,"left")});break;case"bottom":n.css({top:i(window).height()+n.height(),left:f.calculatePos(n,"left")});break;case"left":n.css({top:f.calculatePos(n,"top"),left:-(n.width())});break;case"right":n.css({top:f.calculatePos(n,"top"),left:i(window).width()+n.width()});break}}else{n.css({top:f.calculatePos(n,"top"),left:f.calculatePos(n,"left")})}}}},calculatePos:function(q,s){var p=i(window).width(),o=i(window).height(),r=q.width(),n=q.height();switch(s){case"left":return(p-r)/2;break;case"top":return(o-n)/2;break;default:if(g.debug){console.log("smartModal Notice: "+s+" not a valid position option.")}break}}};function l(){c=i(".smartmodal").length;if(g.debug){console.log("smartModal Notice: "+c+" smartModals found on the page.")}}function e(){if(g.shortkeys){i(document).keyup(function(n){if(n.keyCode==27){i.each(i(".smartmodal-modal"),function(){if(!i(this).hasClass("sticky")){var o=i(this).attr("id");f.closeModal(o)}})}})}i(".smartmodal .close").bind("click",function(n){var o=i(this).closest(".smartmodal").attr("id");f.closeModal(o)});i(window).resize(function(n){i.each(i(".smartmodal"),function(){var o=i(this).attr("id");f.positionModal(o)})});if(g.clickClose){i("body").delegate("#smartmodal-overlay","click",function(n){n.preventDefault();i.each(i(".smartmodal-modal"),function(){f.closeModal(i(this).attr("id"))})})}}function k(){i(".smartmodal").each(function(){var o=i(this),q=true,p,n;if(!o.attr("id")){while(q){n="smartModal-"+Math.floor((Math.random()*c)+1);if(!i("#"+n).length){o.attr("id",n);q=false}}}p=o.attr("id");if(i.inArray(p,m)>-1){if(g.debug){console.log("smartModal Error: Multiple #"+p+" IDs")}}m.push(p);if(o.hasClass("once")){if(b){if(localStorage["smartModal-"+p]==="shown"){o.remove();o=false;l()}}else{if(d){if(i.cookie("smartModal-"+p)==="shown"){o.remove();o=false;l()}}}}if(o){o.hide();if(o.hasClass("auto")){if(o.data("wait")){setTimeout(function(){f.showModal(p)},(o.data("wait")*1000))}else{f.showModal(p)}}if(i("."+p).length){i("."+p).bind("click",function(r){r.preventDefault();f.showModal(p)})}}})}i.smartModal=function(n,o){if(typeof n=="object"){g=i.extend(g,n);f.init()}else{if(typeof n=="string"&&typeof o=="string"){switch(n){case"show":f.showModal(o);break;case"hide":f.closeModal(o);break;default:if(g.debug){console.log("smartModal Error: "+n+"is not an available method.")}break}}else{if(typeof n=="string"&&typeof o=="object"){switch(n){case"init":if(o){g=i.extend(g,o)}f.init();break;case"settings":g=i.extend(g,o);break;default:if(g.debug){console.log("smartModal Error: "+n+"is not an available method.")}break}}else{if(g.debug){console.log("smartModal Error: Couldn't initialize.")}}}}}}(jQuery));