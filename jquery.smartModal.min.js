/**
 * jQuery smartModal
 * 
 * Version: 1.1.1
 * Author: Ben Marshall
 * Author URL: http://www.benmarshall.me
 * Plugin URL: http://www.benmarshall.me/jquery-smartmodal/
 * GitHub: https://github.com/bmarshall511/jquery-smartModal
 * 
 * Licensed under the MIT license
 */

(function(h){var f={overlayDelay:300,hideDelay:300,cookieExpires:365,debug:false,shortkeys:true,clickClose:true,animationDuration:800,animationEasing:"linear"},b=false,d=false,c=0,a=[],i=[],j=[],g=h("<div />").addClass("smartmodal-overlay").attr("id","smartmodal-overlay").css("display","none"),e={init:function(){if(window.localStorage){b=true}else{if(f.debug){console.log("smartModal Notice: Web storage is not supported. Using the jQuery.cookie plugin instead.")}}if(h.cookie){d=true}else{if(f.debug){console.log("smartModal Notice: The jQuery.cookie plugin could not be loaded. smartModal cookie functionality has been disabled.")}}e.countModals();e.eventHandler();e.setupModals()},showModal:function(k){var s=h("#"+k),o=false,p=f.animationEasing,n=f.animationDuration,m,q,r=true,l=f.cookieExpires;if(!s.length){if(f.debug){console.log("smartModal Error: Modal (#"+k+") not found.")}return false}s.addClass("smartmodal-modal");e.positionModal(k);if(!h("#smartmodal-overlay").length){h("body").append(g)}if(s.data("animation")){if(s.data("animation").indexOf("|")>=0){q=s.data("animation").split("|");if(q[0]){m=q[0]}if(q[1]){p=q[1]}if(q[2]){n=parseInt(q[2],10)}}else{m=s.data("animation")}o=true;e.positionModal(k,m)}g.fadeIn(f.overlayDelay);if(o){s.show().animate({left:e.calculatePos(s,"left"),top:e.calculatePos(s,"top")},{duration:n,specialEasing:{top:p}})}else{s.fadeIn(f.overlayDelay)}if(s.data("time")){if(s.data("close")&&s.data("close")==="manual"){r=false;h(".close",s).hide()}if(r){a[k]=window.setTimeout(function(){var t=false;if(s.hasClass("sticky")){s.removeClass("sticky");t=true}e.closeModal(k);if(t){s.addClass("sticky")}},(s.data("time")*1000))}if(h(".sec",s).length){h(".sec",s).text(s.data("time"));i[k]=window.setInterval(function(){var t=parseInt(h(".sec",s).text(),10)-1;if(t>=0){h(".sec",s).text(t)}else{if(!r&&h(".close",s).is(":hidden")){if(s.hasClass("sticky")&&s.data("time")){s.removeClass("sticky").addClass("wasSticky")}h(".close",s).show()}window.clearInterval(i[k])}},1000)}}if(s.hasClass("once")){if(b){localStorage["smartModal-"+k]="shown"}else{if(d){if(s.data("expires")){l=s.data("expires")}h.cookie("smartModal-"+k,"shown",{path:"/",expires:l})}}if(h("."+k).length){h("."+k).unbind("click")}}},closeModal:function(l){if(h("#"+l).length){var k=h("#"+l);if(!k.hasClass("sticky")){if(k.hasClass("wasSticky")){k.removeClass("wasSticky").addClass("sticky")}if(i[l]){window.clearInterval(i[l])}if(a[l]){window.clearTimeout(a[l])}k.fadeOut(f.hideDelay,function(){if(!h(".smartmodal-modal:visible").length){e.removeOverlay()}})}}},removeOverlay:function(){if(h("#smartmodal-overlay").length){h("#smartmodal-overlay").fadeOut(f.hideDelay,function(){h(this).remove()})}},positionModal:function(m,l){if(m){if(h("#"+m).length){var k=h("#"+m);if(l){switch(l){case"top":k.css({top:-(k.height()),left:e.calculatePos(k,"left")});break;case"bottom":k.css({top:h(window).height()+k.height(),left:e.calculatePos(k,"left")});break;case"left":k.css({top:e.calculatePos(k,"top"),left:-(k.width())});break;case"right":k.css({top:e.calculatePos(k,"top"),left:h(window).width()+k.width()});break}}else{k.css({top:e.calculatePos(k,"top"),left:e.calculatePos(k,"left")})}}}},calculatePos:function(n,p){var m=h(window).width(),l=h(window).height(),o=n.width(),k=n.height();switch(p){case"left":return(m-o)/2;case"top":return(l-k)/2;default:if(f.debug){console.log("smartModal Notice: "+p+" not a valid position option.")}break}},countModals:function(){c=h(".smartmodal").length;if(f.debug){console.log("smartModal Notice: "+c+" smartModals found on the page.")}},eventHandler:function(){if(f.shortkeys){h(document).keyup(function(k){if(k.keyCode===27){h.each(h(".smartmodal-modal"),function(){if(!h(this).hasClass("sticky")){var l=h(this).attr("id");e.closeModal(l)}})}})}h(".smartmodal .close").bind("click",function(){var k=h(this).closest(".smartmodal").attr("id");e.closeModal(k)});h(window).resize(function(){h.each(h(".smartmodal"),function(){var k=h(this).attr("id");e.positionModal(k)})});if(f.clickClose){h("body").delegate("#smartmodal-overlay","click",function(k){k.preventDefault();h.each(h(".smartmodal-modal"),function(){e.closeModal(h(this).attr("id"))})})}},setupModals:function(){h(".smartmodal").each(function(){var l=h(this),n=true,m,k;if(!l.attr("id")){while(n){k="smartModal-"+Math.floor((Math.random()*c)+1);if(!h("#"+k).length){l.attr("id",k);n=false}}}m=l.attr("id");if(h.inArray(m,j)>-1){if(f.debug){console.log("smartModal Error: Multiple #"+m+" IDs")}}j.push(m);if(l.hasClass("once")){if(b){if(localStorage["smartModal-"+m]==="shown"){l.remove();l=false;e.countModals()}}else{if(d){if(h.cookie("smartModal-"+m)==="shown"){l.remove();l=false;e.countModals()}}}}if(l){l.hide();if(l.hasClass("auto")){if(l.data("wait")){setTimeout(function(){e.showModal(m)},(l.data("wait")*1000))}else{e.showModal(m)}}if(h("."+m).length){h("."+m).bind("click",function(o){o.preventDefault();e.showModal(m)})}}})}};h.smartModal=function(k,l){if(typeof k==="object"){f=h.extend(f,k);e.init()}else{if(typeof k==="string"&&typeof l==="string"){switch(k){case"show":e.showModal(l);break;case"hide":e.closeModal(l);break;default:if(f.debug){console.log("smartModal Error: "+k+"is not an available method.")}break}}else{if(typeof k==="string"&&typeof l==="object"){switch(k){case"init":if(l){f=h.extend(f,l)}e.init();break;case"settings":f=h.extend(f,l);break;default:if(f.debug){console.log("smartModal Error: "+k+"is not an available method.")}break}}else{if(f.debug){console.log("smartModal Error: Couldn't initialize.")}}}}}}(jQuery));